

; LOADER.MAC;3 & LOADER.OLD;1 11-AUG-75 1042	PAGE 1



LINE 1, PAGE 1
1)	;MAKE CHANGES TO CONFORM WITH BBN LOADER AND ADD DIRECTORY NAME FIX.
1)		TITLE	LOADER V.057
LINE 1, PAGE 1
2)		TITLE	LOADER V.057


LINE 1, PAGE 2
1)		FAILSW==1
1)		SAILSW==1
1)		SYMARG==1
1)		TENEX==1
1)	
LINE 1, PAGE 2
2)	


LINE 16, PAGE 6
1)	RELLEN==^D40	;#NUMBER OF REL FILES OR LIBRARIES (MUST BE SAME)
1)	
LINE 16, PAGE 6
2)	RELLEN==^D5	;#NUMBER OF REL FILES OR LIBRARIES (MUST BE SAME)
2)	


LINE 30, PAGE 7
1)		JRST	RPGINF	;CAN'T INIT, GET INPUT FROM TTY.
1)		MOVEI	F,3
LINE 30, PAGE 7
2)		JRST	NUTS	;CAN'T INIT, GET INPUT FROM TTY.
2)		MOVEI	F,3


LINE 42, PAGE 7
1)		JRST	RPGINF		;NO.
1)		INIT 16,1	;GET SET TO DELETE FILE
LINE 42, PAGE 7
2)		JRST	NUTS		;NO.
2)		INIT 16,1	;GET SET TO DELETE FILE


; LOADER.MAC;3 & LOADER.OLD;1 11-AUG-75 1042	PAGE 2



LINE 3, PAGE 8
1)		JRST	RPGS3C		;GET BACK IN MAIN STREAM
1)	
1)		 JFCL			;ASSUME NO ERRORS
1)	RPGINF:	MOVEI	F,CTLBUF-1	;USE CCL BUFFER
1)		HRRM	F,CTLIN+1	;BYTE POINTER
1)		SETO	1,
1)		MOVEI	2,CTLBUF
1)		JSYS	615		;GTINF
1)		  JFCL			;ASSUME NO ERROR
1)		SKIPN	CTLBUF		;ANY MESSAGES?
1)		JRST	NUTS		;NOTHING THERE GET INPUT FROM TTY
1)		SETO	1,		;CLEAR INFORMATION BUFFER
1)		MOVEI	2,CTLBUF+40
1)		JSYS	614		;PTINF
1)		  JFCL			;ASSUME NO ERROR
1)		MOVEI	N,241		;NUMBER OF CHARACTERS
1)		MOVEM	N,CTLIN+2	;STORE IN BUFFER HEADER
1)		MOVEI	N,700		;BYTE POINTER
1)		HRLM	N,CTLIN+1	;BYTE POINTER COMPLETE
1)		SETOM	TMPFLG		;MARK THAT WE GOT STUFF
1)		SETZM	NONLOD		;FAKE IT
1)	RPGS3C:	TTCALL	3,[ASCIZ /LOADING/]	;PRINT MESSAGE THAT WE ARE STARTING.
LINE 3, PAGE 8
2)	RPGS3C:	TTCALL	3,[ASCIZ /LOADING/]	;PRINT MESSAGE THAT WE ARE STARTING.


LINE 12, PAGE 11
1)		MOVEM	T,OLDDEV		;TO MAKE DEVICE LESS STICKEY
1)	;	SETZM	OLDDEV	;TO MAKE IT GO BACK AFTER /D FOR LIBSR
1)	
LINE 12, PAGE 11
2)		SETZM	OLDDEV	;TO MAKE IT GO BACK AFTER /D FOR LIBSR
2)	


LINE 33, PAGE 11
1)	;LD2DA:	SETZB   W,OLDDEV	;INITIALIZE IDENTIFIER SCAN
1)	LD2DA:	SETZ    W,		;FIX TO MAKE DIVECE NON-STICKEY
1)		MOVEI   E,6 		;INITIALIZE CHARACTER COUNTER
LINE 32, PAGE 11
2)	LD2DA:	SETZB   W,OLDDEV		;INITIALIZE IDENTIFIER SCAN
2)		MOVEI   E,6 		;INITIALIZE CHARACTER COUNTER


; LOADER.MAC;3 & LOADER.OLD;1 11-AUG-75 1042	PAGE 3



LINE 18, PAGE 13
1)	RPGRD4:	STATO	17,740000
1)		JRST	RPGRD3	;END OF FILE
LINE 18, PAGE 13
2)		STATO	17,740000
2)		JRST	RPGRD3	;END OF FILE


LINE 10, PAGE 15
1)	IFN PP,<CAIE	T,"<"			;ALLOW < OR [ FOR PROJECT-PROG
1)		CAIN	T,"["			;PROJ-PROG #?
1)		JRST	[TLO	N,PPSW+PPCSW	;SET FLAGS
LINE 10, PAGE 15
2)	IFN PP,<CAIN	T,"["			;PROJ-PROG #?
2)		JRST	[TLO	N,PPSW+PPCSW	;SET FLAGS


LINE 17, PAGE 15
1)	IFE STANSW,<	JRST	LD6APP]>		;READ NUMBERS AS SWITCHES
1)	IFN STANSW,<	JRST	LD2D]>
1)		CAIE	T,">"			;ALLOW BOTH ] AND >
1)		CAIN	T,"]"			;END OF PP #?
LINE 16, PAGE 15
2)	IFE STANSW,<	JRST	LD6A2]>		;READ NUMBERS AS SWITCHES
2)	IFN STANSW,<	JRST	LD2D]>
2)		CAIN	T,"]"			;END OF PP #?


LINE 45, PAGE 20
1)	;	MOVE X,.JBSA(X)		;NEW START ADDRESS
1)	;	HRLI X,<JRST>B53	;JRST IN LH
1)		MOVE X,STADDR		;GET PROGRAM START ADDRESS
1)		TLNN X,-1
1)		HRLI X,(JRST)		;DEFAULT TO DEC-STYLE ENTRY VECTOR
1)		MOVEI N,400000		;THIS FORK
LINE 45, PAGE 20
2)		MOVE X,.JBSA(X)		;NEW START ADDRESS
2)		HRLI X,<JRST>B53	;JRST IN LH
2)		MOVEI N,400000		;THIS FORK


; LOADER.MAC;3 & LOADER.OLD;1 11-AUG-75 1042	PAGE 4



LINE 4, PAGE 35
1)	;HERE WHEN CONVERTING TENEX DIRECTORY NAME TO DIRECTORY NUMBER
1)	
1)	LD6APP:	MOVE	D,N
1)		PUSHJ	P,GETBUF
1)		CAIG	T,172		;IS IT ABOVE LOWERCASE Z
1)		CAIGE	T,"A"
1)		JRST	FLDRT4		;IS NOT A VALID CHARACTER
1)		CAIL	T,133		;IS IT BETWEEN UPPER Z AND LOWER A
1)		CAILE	T,140
1)		SKIPA
1)		JRST	FLDRT4
1)		PUSH	P,1
1)		PUSH	P,2
1)		PUSH	P,3
1)		HRLI	2,440700
1)		HRRI	2,1(P)
1)		SETZ	3,
1)		MOVEI	1,8
1)	FLDRT1:	PUSH	P,3
1)		SOJG	1,FLDRT1
1)		MOVEI	3,^D39
1)		SKIPA
1)	FLDRT2:	PUSHJ	P,GETBUF
1)		CAIE	T,">"
1)		CAIN	T,"]"
1)		JRST	FLDRT3
1)		IDPB	T,2
1)		SOSLE	3
1)		JRST	FLDRT2
1)	FLDRT3:	MOVSI	1,400000
1)		IDPB	1,2
1)		SUB	P,[XWD 8,8]
1)		HRROI	2,1(P)
1)		JSYS	40			;STDIR
1)		JRST	LD7A
1)		JRST	LD7A
1)		HRLI	1,1
1)		MOVEM	1,PPN
1)		MOVE	W,1
1)		POP	P,3
1)		POP	P,2
1)		POP	P,1
1)		MOVE	N,D
1)		TLZ	N,PPSW+PPCSW
1)		PUSHJ	P,RBRA2
1)		JRST	LD3
1)	
1)	FLDRT4:	IFN RPGSW,<TLNE D,RPGF	;CHECK RPG FEATURE


; LOADER.MAC;3 & LOADER.OLD;1 11-AUG-75 1042	PAGE 5


1)		JRST	[MOVE	1,CTLIN+1
1)			JSYS	42		;BKJFN
1)			JFCL
1)			MOVEM	1,CTLIN+1
1)			AOS	CTLIN+2
1)			MOVE	N,D
1)			JRST	LD6A2 ]  >
1)		MOVE	1,BUFI1
1)		JSYS	42			;BKJFN
1)		JFCL
1)		MOVEM	1,BUFI1
1)		AOS	BUFI2
1)		MOVE	N,D
1)		JRST	LD6A2
1)	
1)	
1)	
1)	
1)	GETBUF:	IFN RPGSW,<TLNE D,RPGF	;CHECK RPG FEATURE
1)		JRST	GETBRP>
1)		SOSGE	BUFI2		;DECREMENT CHARACTER COUNTER
1)		JRST	[INPUT	3,	;FILL TTY BUFFER
1)			JRST	.-1]	;MAKE SURE NOT A NULL BUFFER
1)		ILDB	T,BUFI1		;LOAD T WITH NEXT CHARACTER
1)		POPJ	P,
1)	
1)	
1)	GETBR1:	MOVNI T,5
1)		ADDM T,CTLIN+2
1)		AOS	CTLIN+1
1)	GETBRP:	SOSG	CTLIN+2	;CHECK CHARACTER COUNT.
1)		JRST	GETBR2
1)		IBP	CTLIN+1	;ADVANCE POINTER
1)		MOVE	T,@CTLIN+1	;AND CHECK FOR LINE #
1)		TRNE	T,1
1)		JRST	GETBR1
1)		LDB	T,CTLIN+1	;GET CHR
1)		POPJ	P,
1)	
1)	GETBR2:
1)	IFN TEMP,<SKIPE	TMPFLG	;TMPCOR UUO READ DONE?
1)		JRST	RPGRD3	;YES, SO SHOULD NEVER GET HERE>
1)		IN	17,0
1)		JRST	GETBRP+2
1)		JRST	RPGRD4
1)	
1)	
1)	LD6A:	CAIN	T,57		;WAS CHAR A SLASH?
LINE 4, PAGE 35
2)	LD6A:	CAIN	T,57		;WAS CHAR A SLASH?


; LOADER.MAC;3 & LOADER.OLD;1 11-AUG-75 1042	PAGE 6



LINE 21, PAGE 42
1)	IFE SPCHN,<	BYTE	(4)2,2,2,2,6,0,10,10,10>
1)	IFN SPCHN,<	BYTE	(4)2,2,2,2,6,0,10,10,10>
1)	IFE RPGSW,<	BYTE	(4)0,0,1,1,1,1,1,1,1>
LINE 21, PAGE 42
2)	IFE SPCHN,<	BYTE	(4)2,2,2,2,6,0,0,10,0>
2)	IFN SPCHN,<	BYTE	(4)2,2,2,2,6,0,1,10,1>
2)	IFE RPGSW,<	BYTE	(4)0,0,1,1,1,1,1,1,1>


LINE 5, PAGE 67
1)	;	HRRZM	C,STADDR	;SET STARTING ADDRESS
1)		MOVEM	C,STADDR	;SET STARTING ADDRESS
1)	IFN NAMESW,<
LINE 5, PAGE 67
2)		HRRZM	C,STADDR	;SET STARTING ADDRESS
2)	IFN NAMESW,<


LINE 28, PAGE 129
1)	^L
1)	LINE 28, PAGE 129
2)	^L2)	